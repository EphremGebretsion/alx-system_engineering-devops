#!/usr/bin/env bash
#install HAproxy load balancer
sudo apt-get update
sudo apt-get install --no-install-recommends software-properties-common -y
sudo add-apt-repository ppa:vbernat/haproxy-2.0 -y
sudo apt-get update
sudo apt-get install haproxy=2.0.\* -y
sudo mv /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.org
sudo echo "ENABLED=1">> /etc/default/haproxy
sudo touch /etc/haproxy/haproxy.cfg
sudo echo "defaults
	mode http
	timeout connect  5000
	timeout client  10000
	timeout server  10000
frontend my_frontend
	bind *:80
	default_backend my_servers

backend servers
	balance roundrobin
	server 58119-web-01 52.91.133.216:80 check
	server 58119-web-02 54.227.128.170:80 check" >> /etc/haproxy/haproxy.cfg
sudo systemctl enable haproxy
sudo service haproxy restart
